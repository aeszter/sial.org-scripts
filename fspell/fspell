#!/usr/bin/perl -w
#
# $Id$
#
# The author disclaims all copyrights and releases this script into the
# public domain.
#
# Run perldoc(1) on this file for additional documentation.
#
######################################################################
#
# REQUIREMENTS

require 5;

use strict;

######################################################################
#
# MODULES

use Carp;
use Getopt::Std;

# no OO interface, so import routines we need
use String::Approx qw'amatch aslice';

######################################################################
#
# VARIABLES

my $VERSION; ($VERSION = '$Revision$ ') =~ s/[^0-9.]//g;

my (%opts, $modifiers, $string);
# TODO this can also be /usr/dict/words on certain systems
my $dict_file_loc = '/usr/share/dict/words';

######################################################################
#
# MAIN

# parse command-line options
getopts('h?f:m:', \%opts);

help() if exists $opts{'h'} or exists $opts{'?'};

$dict_file_loc = $opts{'f'} if defined $opts{'f'};

# better to make these CSV so can easily translate to amatch args??
$modifiers = $opts{'m'} if defined $opts{'m'};

# pull word in question off of ARGV
$string = shift;

# parse dictionary file looking for near hits
open DICTFILE, "< $dict_file_loc" or die "Problem opening $dict_file_loc: $!\n";
while (<DICTFILE>) {
  unless (defined $modifiers) {
    print if amatch($string);
  } else {
    print if amatch($string, ["$modifiers%"]);
  }
}
close DICTFILE;

exit;

######################################################################
#
# SUBROUTINES

# a generic help blarb
sub help {
  print <<"HELP";
Usage: $0 [options]

Options:
  -h/-?  Display this message

  -f xx  Use alternate dictionary file location.
  -m xx  Number used as percentage fuzzyness allowed.

Run perldoc on this script for more documentation.

HELP
  exit;
}

__END__

######################################################################
#
# DOCUMENTATION

=head1 NAME

fspell - perl script to do fuzzy speling matching.

=head1 SYNOPSIS

$ fspell speling

To get a list of words similar to speling.

=head1 DESCRIPTION

This script is aimed at certain people who cannot spell words well,
especially when they don't know the first few letters of a word and
end up bouncing around in a dictionary for ages.

A modern spelling checker will probably do a better job, but that
usually involves getting to an application that has the spelling
checker, writing the word into a new document, then finding the spell
check option, and potentially fending off obnoxious paper clips if you
have the misfortune of being on a recent Microsoft OS.

=head1 USAGE

$ fspell [OPTIONS] word

=head1 OPTIONS

The following optional options are supported by fspell:

  -h/?    Show a brief help page.

  -f xx   Use alternate words file, located at xx.  Default is
          /usr/dict/words.

  -m xx   Percentage fuzzyness.  Default is 10, which is usually
          good enough; 20-30 is usually enough for tricky words.

=head1 FILES

/usr/share/dict/words - default dictionary file used; a modestly
populated file available on every unix I've gone looking for the file
on.

=head1 BUGS

=head2 Reporting Bugs

Newer versions of this script may be available from:

http://sial.org/code/perl/

If the bug is in the latest version, send a report to the author.
Patches that fix problems or add new features are welcome.

=head2 Known Issues

No known bugs.

=head1 TODO

Need better way of passing in amatch() params.  Also want to be able
to optionally show where the errors were made, so the person can use
that feedback to spot patterns in their spelling errors.

=head1 SEE ALSO

perl(1).

=head1 AUTHOR

Jeremy Mates, http://sial.org/contact/

=head1 COPYRIGHT

The author disclaims all copyrights and releases this script into the
public domain.

=cut
