#!/bin/sh
#
# $Id$
#
# The author disclaims all copyrights and releases this script into the
# public domain.
#
# Wrapper to commit changes back to CVS or Subversion.

# for CVS
commit_cvs () {
  cvs ci $MESSAGE $CHANGESFILE $@
  exit $?
}

# for subversion
commit_svn () {
  svn ci $MESSAGE $CHANGESFILE $@
  exit $?
}

# process arguments
OPT=
CHANGESFILE=
while getopts F:m: OPT; do
  case $OPT in
    F)
      CHANGESFILE=$OPTARG
      if [ ! -f "$CHANGESFILE" ]; then
        echo "error: change file not a file: $CHANGESFILE" >&2
	exit 1
      fi
      CHANGESFILE="-F $CHANGESFILE"
    ;;
    m)
      MESSAGE=$OPTARG
      if [ -z "$MESSAGE" ]; then
        echo "error: no commit message" >&2
        exit 1
      fi
      MESSAGE="-m '$MESSAGE'"
    ;;
  esac
done
shift $(($OPTIND - 1))

# -m message trumps -F file?
if [ ! -z "$CHANGESFILE" -a ! -z "$MESSAGE" ]; then
  echo "error: cannot specify both -m and -F options" >&2
  exit 1
fi

# figure out what to do
if [ -f CVS/Root ]; then
  commit_cvs $@
elif [ -f .svn/entries ]; then
  commit_svn $@
else
  echo "error: could not determine how to commit: dir=`pwd`" >&2
  exit 1
fi
